/* Copyright 2014 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*jshint globalstrict: false */
/* globals PDFJS, PDFViewer, PDFPageView, TextLayerBuilder, PDFLinkService,
           DefaultTextLayerFactory, AnnotationLayerBuilder, PDFHistory,
           DefaultAnnotationLayerFactory, getFileName, ProgressBar */'use strict';"undefined"===typeof PDFJS&&(("undefined"!==typeof window?window:this).PDFJS={});(function(){function F(c){c=(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1);return{sx:c,sy:c,scaled:1!==c}}function w(c,a,d){var b=c.offsetParent;if(b){d=d||!1;var f=c.offsetTop+c.clientTop;for(c=c.offsetLeft+c.clientLeft;b.clientHeight===b.scrollHeight||d&&"hidden"===getComputedStyle(b).overflow;)if(b.dataset._scaleY&&(f/=b.dataset._scaleY,c/=b.dataset._scaleX),f+=b.offsetTop,c+=b.offsetLeft,b=b.offsetParent,!b)return;a&&(void 0!==a.top&&(f+=a.top),void 0!==a.left&&(c+=a.left,b.scrollLeft=c));b.scrollTop=f}else console.error("offsetParent is not set -- cannot scroll")}function G(c,a){var d=function(d){f||(f=window.requestAnimationFrame(function(){f=null;var d=c.scrollTop,e=b.lastY;d!==e&&(b.down=d>e);b.lastY=d;a(b)}))},b={down:!0,lastY:c.scrollTop,_eventHandler:d},f=null;c.addEventListener("scroll",d,!0);return b}function H(c,a){var d=0,b=c.length-1;if(0===c.length||!a(c[b]))return c.length;if(a(c[d]))return d;for(;d<b;){var f=d+b>>1;a(c[f])?b=f:d=f+1}return d}function z(c){if(Math.floor(c)===c)return[c,1];var a=1/c;if(8<a)return[1,8];if(Math.floor(a)===a)return[1,a];for(var a=1<c?a:c,d=0,b=1,f=1,e=1;;){var g=d+f,m=b+e;if(8<m)break;a<=g/m?(f=g,e=m):(d=g,b=m)}return a-d/b<f/e-a?a===c?[d,b]:[b,d]:a===c?[f,e]:[e,f]}function v(c,a){var d=c%a;return 0===d?c:Math.round(c-d+a)}function I(c,a,d){function b(a){a=a.div;return a.offsetTop+a.clientTop+a.clientHeight>f}var f=c.scrollTop,e=f+c.clientHeight,g=c.scrollLeft,m=g+c.clientWidth;c=[];for(var h,l,k,n,q,r=0===a.length?0:H(a,b),t=a.length;r<t;r++){h=a[r];l=h.div;k=l.offsetTop+l.clientTop;n=l.clientHeight;if(k>e)break;q=l.offsetLeft+l.clientLeft;l=l.clientWidth;q+l<g||q>m||(l=Math.max(0,f-k)+Math.max(0,k+n-e),n=100*(n-l)/n|0,c.push({id:h.id,x:q,y:k,view:h,percent:n}))}a=c[0];e=c[c.length-1];d&&c.sort(function(a,d){var b=a.percent-d.percent;return.001<Math.abs(b)?-b:a.id-d.id});return{first:a,last:e,views:c}}function B(){}function C(){}var u=96/72,J=function(){function c(a,d){this.visible=!0;this.div=document.querySelector(a+" .progress");this.bar=this.div.parentNode;this.height=d.height||100;this.width=d.width||100;this.units=d.units||"%";this.div.style.height=this.height+this.units;this.percent=0}c.prototype={updateBar:function(){this._indeterminate?(this.div.classList.add("indeterminate"),this.div.style.width=this.width+this.units):(this.div.classList.remove("indeterminate"),this.div.style.width=this.width*this._percent/100+this.units)},get percent(){return this._percent},set percent(a){this._indeterminate=isNaN(a);this._percent=Math.min(Math.max(a,0),100);this.updateBar()},setWidth:function(a){a&&(a=a.parentNode.offsetWidth-a.offsetWidth,0<a&&this.bar.setAttribute("style","width: calc(100% - "+a+"px);"))},hide:function(){this.visible&&(this.visible=!1,this.bar.classList.add("hidden"),document.body.classList.remove("loadingInProgress"))},show:function(){this.visible||(this.visible=!0,document.body.classList.add("loadingInProgress"),this.bar.classList.remove("hidden"))}};return c}(),K=function(){function c(){this._pagesRefCache=this.pdfHistory=this.pdfViewer=this.pdfDocument=this.baseUrl=null}c.prototype={setDocument:function(a,d){this.baseUrl=d;this.pdfDocument=a;this._pagesRefCache=Object.create(null)},setViewer:function(a){this.pdfViewer=a},setHistory:function(a){this.pdfHistory=a},get pagesCount(){return this.pdfDocument.numPages},get page(){return this.pdfViewer.currentPageNumber},set page(a){this.pdfViewer.currentPageNumber=a},navigateTo:function(a){var d="",b=this,f=function(e){var c=e instanceof Object?b._pagesRefCache[e.num+" "+e.gen+" R"]:e+1;c?(c>b.pagesCount&&(c=b.pagesCount),b.pdfViewer.scrollPageIntoView(c,a),b.pdfHistory&&b.pdfHistory.push({dest:a,hash:d,page:c})):b.pdfDocument.getPageIndex(e).then(function(a){b._pagesRefCache[e.num+" "+e.gen+" R"]=a+1;f(e)})},e;"string"===typeof a?(d=a,e=this.pdfDocument.getDestination(a)):e=Promise.resolve(a);e.then(function(d){a=d;d instanceof Array&&f(d[0])})},getDestinationHash:function(a){if("string"===typeof a)return this.getAnchorUrl("#"+escape(a));if(a instanceof Array){var d=a[0];if(d=d instanceof Object?this._pagesRefCache[d.num+" "+d.gen+" R"]:d+1){var d=this.getAnchorUrl("#page\x3d"+d),b=a[1];if("object"===typeof b&&"name"in b&&"XYZ"===b.name){var b=a[4]||this.pdfViewer.currentScaleValue,f=parseFloat(b);f&&(b=100*f);d+="\x26zoom\x3d"+b;if(a[2]||a[3])d+=","+(a[2]||0)+","+(a[3]||0)}return d}}return this.getAnchorUrl("")},getAnchorUrl:function(a){return(this.baseUrl||"")+a},setHash:function(a){if(0<=a.indexOf("\x3d")){var d=a.split("\x26");a={};for(var b=0,f=d.length;b<f;++b){var e=d[b].split("\x3d"),g=e[0].toLowerCase(),e=1<e.length?e[1]:null;a[decodeURIComponent(g)]=decodeURIComponent(e)}if("nameddest"in a)this.pdfHistory&&this.pdfHistory.updateNextHashParam(a.nameddest),this.navigateTo(a.nameddest);else{var c,h;"page"in a&&(c=a.page|0||1);"zoom"in a&&(d=a.zoom.split(","),b=d[0],f=parseFloat(b),-1===b.indexOf("Fit")?h=[null,{name:"XYZ"},1<d.length?d[1]|0:null,2<d.length?d[2]|0:null,f?f/100:b]:"Fit"===b||"FitB"===b?h=[null,{name:b}]:"FitH"===b||"FitBH"===b||"FitV"===b||"FitBV"===b?h=[null,{name:b},1<d.length?d[1]|0:null]:"FitR"===b?5!==d.length?console.error("PDFLinkService_setHash: Not enough parameters for 'FitR'."):h=[null,{name:b},d[1]|0,d[2]|0,d[3]|0,d[4]|0]:console.error("PDFLinkService_setHash: '"+b+"' is not a valid zoom value."));h?this.pdfViewer.scrollPageIntoView(c||this.page,h):c&&(this.page=c);"pagemode"in a&&(c=document.createEvent("CustomEvent"),c.initCustomEvent("pagemode",!0,!0,{mode:a.pagemode}),this.pdfViewer.container.dispatchEvent(c))}}else/^\d+$/.test(a)?this.page=a:(this.pdfHistory&&this.pdfHistory.updateNextHashParam(unescape(a)),this.navigateTo(unescape(a)))},executeNamedAction:function(a){switch(a){case "GoBack":this.pdfHistory&&this.pdfHistory.back();break;case "GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case "NextPage":this.page++;break;case "PrevPage":this.page--;break;case "LastPage":this.page=this.pagesCount;break;case "FirstPage":this.page=1}var d=document.createEvent("CustomEvent");d.initCustomEvent("namedaction",!0,!0,{action:a});this.pdfViewer.container.dispatchEvent(d)},cachePageRef:function(a,d){this._pagesRefCache[d.num+" "+d.gen+" R"]=a}};return c}(),L=function(){function c(){this.idleTimeout=this.highestPriorityPage=this.onIdle=this.pdfThumbnailViewer=this.pdfViewer=null;this.isThumbnailViewEnabled=this.printing=!1}c.prototype={setViewer:function(a){this.pdfViewer=a},setThumbnailViewer:function(a){this.pdfThumbnailViewer=a},isHighestPriority:function(a){return this.highestPriorityPage===a.renderingId},renderHighestPriority:function(a){this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null);this.pdfViewer.forceRendering(a)||this.pdfThumbnailViewer&&this.isThumbnailViewEnabled&&this.pdfThumbnailViewer.forceRendering()||this.printing||!this.onIdle||(this.idleTimeout=setTimeout(this.onIdle.bind(this),3E4))},getHighestPriority:function(a,d,b){var f=a.views,e=f.length;if(0===e)return!1;for(var g=0;g<e;++g){var c=f[g].view;if(!this.isViewFinished(c))return c}a=b?a.last.id:a.first.id-2;return d[a]&&!this.isViewFinished(d[a])?d[a]:null},isViewFinished:function(a){return 3===a.renderingState},renderView:function(a){switch(a.renderingState){case 3:return!1;case 2:this.highestPriorityPage=a.renderingId;a.resume();break;case 1:this.highestPriorityPage=a.renderingId;break;case 0:this.highestPriorityPage=a.renderingId;var d=function(){this.renderHighestPriority()}.bind(this);a.draw().then(d,d)}return!0}};return c}(),D=function(){function c(a){var d=a.container,b=a.id,f=a.scale,e=a.defaultViewport,g=a.renderingQueue,c=a.textLayerFactory;a=a.annotationLayerFactory;this.id=b;this.renderingId="page"+b;this.rotation=0;this.scale=f||1;this.viewport=e;this.pdfPageRotate=e.rotation;this.hasRestrictedScaling=!1;this.renderingQueue=g;this.textLayerFactory=c;this.annotationLayerFactory=a;this.renderingState=0;this.annotationLayer=this.zoomLayer=this.textLayer=this.onAfterDraw=this.onBeforeDraw=this.resume=null;b=document.createElement("div");b.id="pageContainer"+this.id;b.className="page";b.style.width=Math.floor(this.viewport.width)+"px";b.style.height=Math.floor(this.viewport.height)+"px";b.setAttribute("data-page-number",this.id);this.div=b;d.appendChild(b)}c.prototype={setPdfPage:function(a){this.pdfPage=a;this.pdfPageRotate=a.rotate;this.viewport=a.getViewport(this.scale*u,(this.rotation+this.pdfPageRotate)%360);this.stats=a.stats;this.reset()},destroy:function(){this.zoomLayer=null;this.reset();this.pdfPage&&this.pdfPage.cleanup()},reset:function(a,d){this.renderTask&&this.renderTask.cancel();this.resume=null;this.renderingState=0;var b=this.div;b.style.width=Math.floor(this.viewport.width)+"px";b.style.height=Math.floor(this.viewport.height)+"px";for(var f=b.childNodes,e=a&&this.zoomLayer||null,g=d&&this.annotationLayer&&this.annotationLayer.div||null,c=f.length-1;0<=c;c--){var h=f[c];e!==h&&g!==h&&b.removeChild(h)}b.removeAttribute("data-loaded");g?this.annotationLayer.hide():this.annotationLayer=null;this.canvas&&!e&&(this.canvas.width=0,this.canvas.height=0,delete this.canvas);this.loadingIconDiv=document.createElement("div");this.loadingIconDiv.className="loadingIcon";b.appendChild(this.loadingIconDiv)},update:function(a,d){this.scale=a||this.scale;"undefined"!==typeof d&&(this.rotation=d);this.viewport=this.viewport.clone({scale:this.scale*u,rotation:(this.rotation+this.pdfPageRotate)%360});var b=!1;if(this.canvas&&0<PDFJS.maxCanvasPixels){var f=this.outputScale;(Math.floor(this.viewport.width)*f.sx|0)*(Math.floor(this.viewport.height)*f.sy|0)>PDFJS.maxCanvasPixels&&(b=!0)}if(this.canvas){if(PDFJS.useOnlyCssZoom||this.hasRestrictedScaling&&b){this.cssTransform(this.canvas,!0);b=document.createEvent("CustomEvent");b.initCustomEvent("pagerendered",!0,!0,{pageNumber:this.id,cssTransform:!0});this.div.dispatchEvent(b);return}this.zoomLayer||(this.zoomLayer=this.canvas.parentNode,this.zoomLayer.style.position="absolute")}this.zoomLayer&&this.cssTransform(this.zoomLayer.firstChild);this.reset(!0,!0)},updatePosition:function(){this.textLayer&&this.textLayer.render(200)},cssTransform:function(a,d){var b=PDFJS.CustomStyle,f=this.viewport.width,e=this.viewport.height,c=this.div;a.style.width=a.parentNode.style.width=c.style.width=Math.floor(f)+"px";a.style.height=a.parentNode.style.height=c.style.height=Math.floor(e)+"px";var c=this.viewport.rotation-a._viewport.rotation,m=Math.abs(c),h=1,l=1;if(90===m||270===m)h=e/f,l=f/e;b.setProp("transform",a,"rotate("+c+"deg) scale("+h+","+l+")");if(this.textLayer){m=this.textLayer.viewport;e=Math.abs(this.viewport.rotation-m.rotation);c=f/m.width;if(90===e||270===e)c=f/m.height;var f=this.textLayer.textLayerDiv,k,n;switch(e){case 0:k=n=0;break;case 90:k=0;n="-"+f.style.height;break;case 180:k="-"+f.style.width;n="-"+f.style.height;break;case 270:k="-"+f.style.width;n=0;break;default:console.error("Bad rotation value.")}b.setProp("transform",f,"rotate("+e+"deg) scale("+c+", "+c+") translate("+k+", "+n+")");b.setProp("transformOrigin",f,"0% 0%")}d&&this.annotationLayer&&this.annotationLayer.render(this.viewport,"display")},get width(){return this.viewport.width},get height(){return this.viewport.height},getPagePoint:function(a,d){return this.viewport.convertToPdfPoint(a,d)},draw:function(){function a(a){A===p.renderTask&&(p.renderTask=null);if("cancelled"===a)t(a);else{p.renderingState=3;m&&(p.canvas.removeAttribute("hidden"),m=!1);p.loadingIconDiv&&(f.removeChild(p.loadingIconDiv),delete p.loadingIconDiv);if(p.zoomLayer){var b=p.zoomLayer.firstChild;b.width=0;b.height=0;f.removeChild(p.zoomLayer);p.zoomLayer=null}p.error=a;p.stats=d.stats;if(p.onAfterDraw)p.onAfterDraw();b=document.createEvent("CustomEvent");b.initCustomEvent("pagerendered",!0,!0,{pageNumber:p.id,cssTransform:!1});f.dispatchEvent(b);a?t(a):r(void 0)}}0!==this.renderingState&&console.error("Must be in new state before drawing");this.renderingState=1;var d=this.pdfPage,b=this.viewport,f=this.div,e=document.createElement("div");e.style.width=f.style.width;e.style.height=f.style.height;e.classList.add("canvasWrapper");var c=document.createElement("canvas");c.id="page"+this.id;c.setAttribute("hidden","hidden");var m=!0;e.appendChild(c);this.annotationLayer&&this.annotationLayer.div?f.insertBefore(e,this.annotationLayer.div):f.appendChild(e);this.canvas=c;var h=c.getContext("2d",{alpha:!1}),l=F(h);this.outputScale=l;if(PDFJS.useOnlyCssZoom){var k=b.clone({scale:u});l.sx*=k.width/b.width;l.sy*=k.height/b.height;l.scaled=!0}0<PDFJS.maxCanvasPixels&&(k=Math.sqrt(PDFJS.maxCanvasPixels/(b.width*b.height)),l.sx>k||l.sy>k?(l.sx=k,l.sy=k,this.hasRestrictedScaling=l.scaled=!0):this.hasRestrictedScaling=!1);var k=z(l.sx),n=z(l.sy);c.width=v(b.width*l.sx,k[0]);c.height=v(b.height*l.sy,n[0]);c.style.width=v(b.width,k[1])+"px";c.style.height=v(b.height,n[1])+"px";c._viewport=b;var q=b=null;this.textLayerFactory&&(b=document.createElement("div"),b.className="textLayer",b.style.width=e.style.width,b.style.height=e.style.height,this.annotationLayer&&this.annotationLayer.div?f.insertBefore(b,this.annotationLayer.div):f.appendChild(b),q=this.textLayerFactory.createTextLayerBuilder(b,this.id-1,this.viewport));this.textLayer=q;var r,t,e=new Promise(function(a,b){r=a;t=b}),p=this,b=null;this.renderingQueue&&(b=function(a){p.renderingQueue.isHighestPriority(p)?(m&&(p.canvas.removeAttribute("hidden"),m=!1),a()):(p.renderingState=2,p.resume=function(){p.renderingState=1;a()})});var A=this.renderTask=this.pdfPage.render({canvasContext:h,transform:l.scaled?[l.sx,0,0,l.sy,0,0]:null,viewport:this.viewport});A.onContinue=b;this.renderTask.promise.then(function(){a(null);q&&p.pdfPage.getTextContent({normalizeWhitespace:!0}).then(function(a){q.setTextContent(a);q.render(200)})},function(b){a(b)});this.annotationLayerFactory&&(this.annotationLayer||(this.annotationLayer=this.annotationLayerFactory.createAnnotationLayerBuilder(f,this.pdfPage)),this.annotationLayer.render(this.viewport,"display"));f.setAttribute("data-loaded",!0);if(p.onBeforeDraw)p.onBeforeDraw();return e},beforePrint:function(){var a=PDFJS.CustomStyle,d=this.pdfPage,b=d.getViewport(1),f=document.createElement("canvas");f.width=2*Math.floor(b.width);f.height=2*Math.floor(b.height);f.style.width="200%";f.style.height="200%";a.setProp("transform",f,"scale(0.5, 0.5)");a.setProp("transformOrigin",f,"0% 0%");var a=document.getElementById("printContainer"),e=document.createElement("div");e.style.width=b.width+"pt";e.style.height=b.height+"pt";e.appendChild(f);a.appendChild(e);f.mozPrintCallback=function(a){var e=a.context;e.save();e.fillStyle="rgb(255, 255, 255)";e.fillRect(0,0,f.width,f.height);e.restore();e._transformMatrix=[2,0,0,2,0,0];e.scale(2,2);d.render({canvasContext:e,viewport:b,intent:"print"}).promise.then(function(){a.done()},function(b){console.error(b);"abort"in a?a.abort():a.done()})}}};return c}(),x=function(){function c(a){this.textLayerDiv=a.textLayerDiv;this.divContentDone=this.renderingDone=!1;this.pageIdx=a.pageIndex;this.pageNumber=this.pageIdx+1;this.matches=[];this.viewport=a.viewport;this.textDivs=[];this.findController=a.findController||null;this.textLayerRenderTask=null;this._bindMouse()}c.prototype={_finishRendering:function(){this.renderingDone=!0;var a=document.createElement("div");a.className="endOfContent";this.textLayerDiv.appendChild(a);a=document.createEvent("CustomEvent");a.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber});this.textLayerDiv.dispatchEvent(a)},render:function(a){if(this.divContentDone&&!this.renderingDone){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null);this.textDivs=[];var d=document.createDocumentFragment();this.textLayerRenderTask=PDFJS.renderTextLayer({textContent:this.textContent,container:d,viewport:this.viewport,textDivs:this.textDivs,timeout:a});this.textLayerRenderTask.promise.then(function(){this.textLayerDiv.appendChild(d);this._finishRendering();this.updateMatches()}.bind(this),function(a){})}},setTextContent:function(a){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null);this.textContent=a;this.divContentDone=!0},convertMatches:function(a){for(var d=0,b=0,f=this.textContent.items,e=f.length-1,c=null===this.findController?0:this.findController.state.query.length,m=[],h=0,l=a.length;h<l;h++){for(var k=a[h];d!==e&&k>=b+f[d].str.length;)b+=f[d].str.length,d++;d===f.length&&console.error("Could not find a matching mapping");for(var n={begin:{divIdx:d,offset:k-b}},k=k+c;d!==e&&k>b+f[d].str.length;)b+=f[d].str.length,d++;n.end={divIdx:d,offset:k-b};m.push(n)}return m},renderMatches:function(a){function d(a,d){var f=a.divIdx;e[f].textContent="";b(f,0,a.offset,d)}function b(a,b,d,c){var g=e[a];a=f[a].str.substring(b,d);a=document.createTextNode(a);c?(b=document.createElement("span"),b.className=c,b.appendChild(a),g.appendChild(b)):g.appendChild(a)}if(0!==a.length){var f=this.textContent.items,e=this.textDivs,c=null,m=this.pageIdx,h=null===this.findController?!1:m===this.findController.selected.pageIdx,l=null===this.findController?-1:this.findController.selected.matchIdx,k=l,n=k+1;if(null===this.findController?0:this.findController.state.highlightAll)k=0,n=a.length;else if(!h)return;for(;k<n;k++){var q=a[k],r=q.begin,q=q.end,t=h&&k===l?" selected":"";this.findController&&this.findController.updateMatchPosition(m,k,e,r.divIdx,q.divIdx);c&&r.divIdx===c.divIdx?b(c.divIdx,c.offset,r.offset):(null!==c&&b(c.divIdx,c.offset,void 0),d(r));if(r.divIdx===q.divIdx)b(r.divIdx,r.offset,q.offset,"highlight"+t);else{b(r.divIdx,r.offset,void 0,"highlight begin"+t);c=r.divIdx+1;for(r=q.divIdx;c<r;c++)e[c].className="highlight middle"+t;d(q,"highlight end"+t)}c=q}c&&b(c.divIdx,c.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var a=this.matches,d=this.textDivs,b=this.textContent.items,f=-1,e=0,c=a.length;e<c;e++){for(var m=a[e],f=Math.max(f,m.begin.divIdx),h=m.end.divIdx;f<=h;f++){var l=d[f];l.textContent=b[f].str;l.className=""}f=m.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}},_bindMouse:function(){var a=this.textLayerDiv;a.addEventListener("mousedown",function(d){var b=a.querySelector(".endOfContent");if(b){if(d.target!==a){var f=a.getBoundingClientRect();b.style.top=(100*Math.max(0,(d.pageY-f.top)/f.height)).toFixed(2)+"%"}b.classList.add("active")}});a.addEventListener("mouseup",function(d){if(d=a.querySelector(".endOfContent"))d.style.top="",d.classList.remove("active")})}};return c}();B.prototype={createTextLayerBuilder:function(c,a,d){return new x({textLayerDiv:c,pageIndex:a,viewport:d})}};var y=function(){function c(a){this.pageDiv=a.pageDiv;this.pdfPage=a.pdfPage;this.linkService=a.linkService;this.div=null}c.prototype={render:function(a,d){var b=this,f={intent:void 0===d?"display":d};this.pdfPage.getAnnotations(f).then(function(d){a=a.clone({dontFlip:!0});f={viewport:a,div:b.div,annotations:d,page:b.pdfPage,linkService:b.linkService};b.div?PDFJS.AnnotationLayer.update(f):0!==d.length&&(b.div=document.createElement("div"),b.div.className="annotationLayer",b.pageDiv.appendChild(b.div),f.div=b.div,PDFJS.AnnotationLayer.render(f),"undefined"!==typeof mozL10n&&mozL10n.translate(b.div))})},hide:function(){this.div&&this.div.setAttribute("hidden","true")}};return c}();C.prototype={createAnnotationLayerBuilder:function(c,a){return new y({pageDiv:c,pdfPage:a,linkService:new E})}};var M=function(){function c(a){var b=[];this.push=function(f){var c=b.indexOf(f);0<=c&&b.splice(c,1);b.push(f);b.length>a&&b.shift().destroy()};this.resize=function(f){for(a=f;b.length>a;)b.shift().destroy()}}function a(a){this.container=a.container;this.viewer=a.viewer||a.container.firstElementChild;this.linkService=a.linkService||new E;this.removePageBorders=a.removePageBorders||!1;(this.defaultRenderingQueue=!a.renderingQueue)?(this.renderingQueue=new L,this.renderingQueue.setViewer(this)):this.renderingQueue=a.renderingQueue;this.scroll=G(this.container,this._scrollUpdate.bind(this));this.updateInProgress=!1;this.presentationModeState=0;this._resetView();this.removePageBorders&&this.viewer.classList.add("removePageBorders")}a.prototype={get pagesCount(){return this._pages.length},getPageView:function(a){return this._pages[a]},get currentPageNumber(){return this._currentPageNumber},set currentPageNumber(a){if(this.pdfDocument){var b=document.createEvent("UIEvents");b.initUIEvent("pagechange",!0,!0,window,0);b.updateInProgress=this.updateInProgress;0<a&&a<=this.pagesCount?(b.previousPageNumber=this._currentPageNumber,this._currentPageNumber=a,b.pageNumber=a,this.container.dispatchEvent(b),this.updateInProgress||this.scrollPageIntoView(a)):(b.pageNumber=this._currentPageNumber,b.previousPageNumber=a,this.container.dispatchEvent(b))}else this._currentPageNumber=a},get currentScale(){return 0!==this._currentScale?this._currentScale:1},set currentScale(a){if(isNaN(a))throw Error("Invalid numeric scale");this.pdfDocument?this._setScale(a,!1):(this._currentScale=a,this._currentScaleValue=0!==a?a.toString():null)},get currentScaleValue(){return this._currentScaleValue},set currentScaleValue(a){this.pdfDocument?this._setScale(a,!1):(this._currentScale=isNaN(a)?0:a,this._currentScaleValue=a)},get pagesRotation(){return this._pagesRotation},set pagesRotation(a){this._pagesRotation=a;for(var b=0,f=this._pages.length;b<f;b++){var c=this._pages[b];c.update(c.scale,a)}this._setScale(this._currentScaleValue,!0);this.defaultRenderingQueue&&this.update()},setDocument:function(a){this.pdfDocument&&this._resetView();if(this.pdfDocument=a){var b=a.numPages,f=this,c,g=new Promise(function(a){c=a});this.pagesPromise=g;g.then(function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pagesloaded",!0,!0,{pagesCount:b});f.container.dispatchEvent(a)});var m=!1,h=null,l=new Promise(function(a){h=a});this.onePageRendered=l;var k=function(a){a.onBeforeDraw=function(){f._buffer.push(this)};a.onAfterDraw=function(){m||(m=!0,h())}};this.firstPagePromise=g=a.getPage(1);return g.then(function(g){var h=this.currentScale;g=g.getViewport(h*u);for(var m=1;m<=b;++m){var t=null;PDFJS.disableTextLayer||(t=this);t=new D({container:this.viewer,id:m,scale:h,defaultViewport:g.clone(),renderingQueue:this.renderingQueue,textLayerFactory:t,annotationLayerFactory:this});k(t);this._pages.push(t)}var p=this.linkService;l.then(function(){if(PDFJS.disableAutoFetch)c();else for(var g=b,h=1;h<=b;++h)a.getPage(h).then(function(a,b){var d=f._pages[a-1];d.pdfPage||d.setPdfPage(b);p.cachePageRef(a,b.ref);g--;g||c()}.bind(null,h))});h=document.createEvent("CustomEvent");h.initCustomEvent("pagesinit",!0,!0,null);f.container.dispatchEvent(h);this.defaultRenderingQueue&&this.update();this.findController&&this.findController.resolveFirstPage()}.bind(this))}},_resetView:function(){this._pages=[];this._currentPageNumber=1;this._currentScale=0;this._currentScaleValue=null;this._buffer=new c(10);this._location=null;this._pagesRotation=0;this._pagesRequests=[];for(var a=this.viewer;a.hasChildNodes();)a.removeChild(a.lastChild)},_scrollUpdate:function(){if(0!==this.pagesCount){this.update();for(var a=0,b=this._pages.length;a<b;a++)this._pages[a].updatePosition()}},_setScaleDispatchEvent:function(a,b,f){var c=document.createEvent("UIEvents");c.initUIEvent("scalechange",!0,!0,window,0);c.scale=a;f&&(c.presetValue=b);this.container.dispatchEvent(c)},_setScaleUpdatePages:function(a,b,f,c){this._currentScaleValue=b;var g;g=this._currentScale;g=a===g?!0:1E-15>Math.abs(a-g)?!0:!1;if(g)c&&this._setScaleDispatchEvent(a,b,!0);else{g=0;for(var m=this._pages.length;g<m;g++)this._pages[g].update(a);this._currentScale=a;if(!f){f=this._currentPageNumber;var h;!this._location||this.isInPresentationMode||this.isChangingPresentationMode||(f=this._location.pageNumber,h=[null,{name:"XYZ"},this._location.left,this._location.top,null]);this.scrollPageIntoView(f,h)}this._setScaleDispatchEvent(a,b,c);this.defaultRenderingQueue&&this.update()}},_setScale:function(a,b){var c=parseFloat(a);if(0<c)this._setScaleUpdatePages(c,a,b,!1);else if(c=this._pages[this._currentPageNumber-1]){var e=(this.container.clientWidth-(this.isInPresentationMode||this.removePageBorders?0:40))/c.width*c.scale,g=(this.container.clientHeight-(this.isInPresentationMode||this.removePageBorders?0:5))/c.height*c.scale;switch(a){case "page-actual":c=1;break;case "page-width":c=e;break;case "page-height":c=g;break;case "page-fit":c=Math.min(e,g);break;case "auto":c=Math.min(1.25,c.width>c.height?Math.min(g,e):e);break;default:console.error("pdfViewSetScale: '"+a+"' is an unknown zoom value.");return}this._setScaleUpdatePages(c,a,b,!0)}},scrollPageIntoView:function(a,b){if(this.pdfDocument){var c=this._pages[a-1];if(this.isInPresentationMode){if(this._currentPageNumber!==c.id){this.currentPageNumber=c.id;return}b=null;this._setScale(this._currentScaleValue,!0)}if(b){var e=0,g=0,m=0,h=0,l,k;k=0===c.rotation%180?!1:!0;l=(k?c.height:c.width)/c.scale/u;k=(k?c.width:c.height)/c.scale/u;var n=0;switch(b[1].name){case "XYZ":e=b[2];g=b[3];n=b[4];e=null!==e?e:0;g=null!==g?g:k;break;case "Fit":case "FitB":n="page-fit";break;case "FitH":case "FitBH":g=b[2];n="page-width";null===g&&this._location&&(e=this._location.left,g=this._location.top);break;case "FitV":case "FitBV":e=b[2];m=l;h=k;n="page-height";break;case "FitR":e=b[2];g=b[3];m=b[4]-e;h=b[5]-g;k=this.removePageBorders?0:5;l=(this.container.clientWidth-(this.removePageBorders?0:40))/m/u;k=(this.container.clientHeight-k)/h/u;n=Math.min(Math.abs(l),Math.abs(k));break;default:return}n&&n!==this._currentScale?this.currentScaleValue=n:0===this._currentScale&&(this.currentScaleValue="auto");"page-fit"!==n||b[4]?(e=[c.viewport.convertToViewportPoint(e,g),c.viewport.convertToViewportPoint(e+m,g+h)],w(c.div,{left:Math.min(e[0][0],e[1][0]),top:Math.min(e[0][1],e[1][1])})):w(c.div)}else w(c.div)}},_updateLocation:function(a){var b=this._currentScale,c=this._currentScaleValue,b=parseFloat(c)===b?Math.round(1E4*b)/100:c,c=a.id,e;e="#page\x3d"+c+("\x26zoom\x3d"+b);var g=this.container,g=this._pages[c-1].getPagePoint(g.scrollLeft-a.x,g.scrollTop-a.y);a=Math.round(g[0]);g=Math.round(g[1]);e+=","+a+","+g;this._location={pageNumber:c,scale:b,top:g,left:a,pdfOpenParams:e}},update:function(){var a=this._getVisiblePages(),b=a.views;if(0!==b.length){this.updateInProgress=!0;this._buffer.resize(Math.max(10,2*b.length+1));this.renderingQueue.renderHighestPriority(a);for(var c=this._currentPageNumber,a=a.first,e=0,g=b.length,m=!1;e<g;++e){var h=b[e];if(100>h.percent)break;if(h.id===c){m=!0;break}}m||(c=b[0].id);this.isInPresentationMode||(this.currentPageNumber=c);this._updateLocation(a);this.updateInProgress=!1;b=document.createEvent("UIEvents");b.initUIEvent("updateviewarea",!0,!0,window,0);b.location=this._location;this.container.dispatchEvent(b)}},containsElement:function(a){return this.container.contains(a)},focus:function(){this.container.focus()},get isInPresentationMode(){return 3===this.presentationModeState},get isChangingPresentationMode(){return 2===this.presentationModeState},get isHorizontalScrollbarEnabled(){return this.isInPresentationMode?!1:this.container.scrollWidth>this.container.clientWidth},_getVisiblePages:function(){if(this.isInPresentationMode){var a=[],b=this._pages[this._currentPageNumber-1];a.push({id:b.id,view:b});return{first:b,last:b,views:a}}return I(this.container,this._pages,!0)},cleanup:function(){for(var a=0,b=this._pages.length;a<b;a++)this._pages[a]&&3!==this._pages[a].renderingState&&this._pages[a].reset()},_ensurePdfPageLoaded:function(a){if(a.pdfPage)return Promise.resolve(a.pdfPage);var b=a.id;if(this._pagesRequests[b])return this._pagesRequests[b];var c=this.pdfDocument.getPage(b).then(function(c){a.setPdfPage(c);this._pagesRequests[b]=null;return c}.bind(this));return this._pagesRequests[b]=c},forceRendering:function(a){a=a||this._getVisiblePages();var b=this.renderingQueue.getHighestPriority(a,this._pages,this.scroll.down);return b?(this._ensurePdfPageLoaded(b).then(function(){this.renderingQueue.renderView(b)}.bind(this)),!0):!1},getPageTextContent:function(a){return this.pdfDocument.getPage(a+1).then(function(a){return a.getTextContent({normalizeWhitespace:!0})})},createTextLayerBuilder:function(a,b,c){return new x({textLayerDiv:a,pageIndex:b,viewport:c,findController:this.isInPresentationMode?null:this.findController})},createAnnotationLayerBuilder:function(a,b){return new y({pageDiv:a,pdfPage:b,linkService:this.linkService})},setFindController:function(a){this.findController=a}};return a}(),E=function(){function c(){}c.prototype={get page(){return 0},set page(a){},navigateTo:function(a){},getDestinationHash:function(a){return"#"},getAnchorUrl:function(a){return"#"},setHash:function(a){},executeNamedAction:function(a){},cachePageRef:function(a,c){}};return c}(),N=function(){function c(a){this.linkService=a.linkService;this.initialized=!1;this.initialBookmark=this.initialDestination=null}c.prototype={initialize:function(a){function c(){e.previousHash=window.location.hash.slice(1);e._pushToHistory({hash:e.previousHash},!1,!0);e._updatePreviousBookmark()}function b(a,b){function c(){window.removeEventListener("popstate",c);window.addEventListener("popstate",d);e._pushToHistory(a,!1,!0);history.forward()}function d(){window.removeEventListener("popstate",d);e.allowHashChange=!0;e.historyUnlocked=!0;b()}e.historyUnlocked=!1;e.allowHashChange=!1;window.addEventListener("popstate",c);history.back()}function f(){var a=e._getPreviousParams(null,!0);a&&(e._pushToHistory(a,!1,!e.current.dest&&e.current.hash!==e.previousHash),e._updatePreviousBookmark());window.removeEventListener("beforeunload",f,!1)}this.initialized=!0;this.reInitialized=!1;this.historyUnlocked=this.allowHashChange=!0;this.isViewerInPresentationMode=!1;this.previousHash=window.location.hash.substring(1);this.currentBookmark="";this.currentPage=0;this.updatePreviousBookmark=!1;this.previousBookmark="";this.previousPage=0;this.nextHashParam="";this.fingerprint=a;this.currentUid=this.uid=0;this.current={};a=window.history.state;this._isStateObjectDefined(a)?(a.target.dest?this.initialDestination=a.target.dest:this.initialBookmark=a.target.hash,this.currentUid=a.uid,this.uid=a.uid+1,this.current=a.target):(a&&a.fingerprint&&this.fingerprint!==a.fingerprint&&(this.reInitialized=!0),this._pushOrReplaceState({fingerprint:this.fingerprint},!0));var e=this;window.addEventListener("popstate",function(a){e.historyUnlocked&&(a.state?e._goTo(a.state):0===e.uid?b(e.previousHash&&e.currentBookmark&&e.previousHash!==e.currentBookmark?{hash:e.currentBookmark,page:e.currentPage}:{page:1},function(){c()}):c())},!1);window.addEventListener("beforeunload",f,!1);window.addEventListener("pageshow",function(a){window.addEventListener("beforeunload",f,!1)},!1);window.addEventListener("presentationmodechanged",function(a){e.isViewerInPresentationMode=!!a.detail.active})},clearHistoryState:function(){this._pushOrReplaceState(null,!0)},_isStateObjectDefined:function(a){return a&&0<=a.uid&&a.fingerprint&&this.fingerprint===a.fingerprint&&a.target&&a.target.hash?!0:!1},_pushOrReplaceState:function(a,c){c?window.history.replaceState(a,""):window.history.pushState(a,"")},get isHashChangeUnlocked(){return this.initialized?this.allowHashChange:!0},_updatePreviousBookmark:function(){this.updatePreviousBookmark&&this.currentBookmark&&this.currentPage&&(this.previousBookmark=this.currentBookmark,this.previousPage=this.currentPage,this.updatePreviousBookmark=!1)},updateCurrentBookmark:function(a,c){this.initialized&&(this.currentBookmark=a.substring(1),this.currentPage=c|0,this._updatePreviousBookmark())},updateNextHashParam:function(a){this.initialized&&(this.nextHashParam=a)},push:function(a,c){if(this.initialized&&this.historyUnlocked)if(a.dest&&!a.hash&&(a.hash=this.current.hash&&this.current.dest&&this.current.dest===a.dest?this.current.hash:this.linkService.getDestinationHash(a.dest).split("#")[1]),a.page&&(a.page|=0),c){var b=window.history.state.target;b||(this._pushToHistory(a,!1),this.previousHash=window.location.hash.substring(1));this.updatePreviousBookmark=this.nextHashParam?!1:!0;b&&this._updatePreviousBookmark()}else{if(this.nextHashParam){if(this.nextHashParam===a.hash){this.nextHashParam=null;this.updatePreviousBookmark=!0;return}this.nextHashParam=null}a.hash?this.current.hash?this.current.hash!==a.hash?this._pushToHistory(a,!0):(!this.current.page&&a.page&&this._pushToHistory(a,!1,!0),this.updatePreviousBookmark=!0):this._pushToHistory(a,!0):this.current.page&&a.page&&this.current.page!==a.page&&this._pushToHistory(a,!0)}},_getPreviousParams:function(a,c){if(!this.currentBookmark||!this.currentPage)return null;this.updatePreviousBookmark&&(this.updatePreviousBookmark=!1);if(0<this.uid&&(!this.previousBookmark||!this.previousPage))return null;if(!this.current.dest&&!a||c){if(this.previousBookmark===this.currentBookmark)return null}else if(this.current.page||a){if(this.previousPage===this.currentPage)return null}else return null;var b={hash:this.currentBookmark,page:this.currentPage};this.isViewerInPresentationMode&&(b.hash=null);return b},_stateObj:function(a){return{fingerprint:this.fingerprint,uid:this.uid,target:a}},_pushToHistory:function(a,c,b){this.initialized&&(!a.hash&&a.page&&(a.hash="page\x3d"+a.page),c&&!b&&(c=this._getPreviousParams())&&this._pushToHistory(c,!1,!this.current.dest&&this.current.hash!==this.previousHash),this._pushOrReplaceState(this._stateObj(a),b||0===this.uid),this.currentUid=this.uid++,this.current=a,this.updatePreviousBookmark=!0)},_goTo:function(a){if(this.initialized&&this.historyUnlocked&&this._isStateObjectDefined(a)){if(!this.reInitialized&&a.uid<this.currentUid){var c=this._getPreviousParams(!0);if(c){this._pushToHistory(this.current,!1);this._pushToHistory(c,!1);this.currentUid=a.uid;window.history.back();return}}this.historyUnlocked=!1;a.target.dest?this.linkService.navigateTo(a.target.dest):this.linkService.setHash(a.target.hash);this.currentUid=a.uid;a.uid>this.uid&&(this.uid=a.uid);this.current=a.target;this.updatePreviousBookmark=!0;a=window.location.hash.substring(1);this.previousHash!==a&&(this.allowHashChange=!1);this.previousHash=a;this.historyUnlocked=!0}},back:function(){this.go(-1)},forward:function(){this.go(1)},go:function(a){if(this.initialized&&this.historyUnlocked){var c=window.history.state;-1===a&&c&&0<c.uid?window.history.back():1===a&&c&&c.uid<this.uid-1&&window.history.forward()}}};return c}();PDFJS.PDFViewer=M;PDFJS.PDFPageView=D;PDFJS.PDFLinkService=K;PDFJS.TextLayerBuilder=x;PDFJS.DefaultTextLayerFactory=B;PDFJS.AnnotationLayerBuilder=y;PDFJS.DefaultAnnotationLayerFactory=C;PDFJS.PDFHistory=N;PDFJS.getFileName=function(c){var a=c.indexOf("#"),d=c.indexOf("?"),a=Math.min(0<a?a:c.length,0<d?d:c.length);return c.substring(c.lastIndexOf("/",a)+1,a)};PDFJS.ProgressBar=J}).call("undefined"===typeof window?this:window);